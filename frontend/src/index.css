@import "tailwindcss";
@import "tw-animate-css";
@import "shadcn/tailwind.css";

@custom-variant dark (&:is(.dark *));

:root {
  --bg: #0f0f0f;
  --surface: #1a1a2e;
  --surface2: #16213e;
  --accent2: #0f3460;
  --text: #eee;
  --text2: #999;
  --green: #00d97e;
  --purple: #9d4edd;
  --radius: 0.625rem;
  color-scheme: dark;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
  /* App-specific overrides — must come after shadcn vars */
  --accent: #e94560;
  --text: #eee;
  --text2: #999;
  --green: #00d97e;
  --purple: #9d4edd;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --radius-2xl: calc(var(--radius) + 8px);
  --radius-3xl: calc(var(--radius) + 12px);
  --radius-4xl: calc(var(--radius) + 16px);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* =====================================================
   App-specific component styles (ported from index.html)
   ===================================================== */

header {
  padding: 24px;
  text-align: center;
}
header h1 { font-size: 1.5rem; font-weight: 600; }

#status {
  color: var(--text2);
  font-size: 0.85rem;
  min-height: 20px;
  margin-bottom: 12px;
  transition: color 0.2s;
}
#status.active { color: var(--green); }
#status.listening { color: var(--accent); }
#status.sleeping { color: var(--purple); }

#chat {
  flex: 1;
  width: 100%;
  max-width: 640px;
  overflow-y: auto;
  padding: 0 16px 120px;
}
.msg {
  margin: 8px 0;
  padding: 12px 16px;
  border-radius: var(--radius);
  max-width: 85%;
  line-height: 1.5;
  font-size: 0.95rem;
  position: relative;
}
.msg.user {
  background: var(--accent2);
  margin-left: auto;
  border-bottom-right-radius: 4px;
}
.msg.assistant {
  background: var(--surface);
  margin-right: auto;
  border-bottom-left-radius: 4px;
}
.msg.system {
  background: rgba(255,255,255,0.05);
  margin-right: auto;
  border-bottom-left-radius: 4px;
  font-style: italic;
  color: var(--text2);
  font-size: 0.85rem;
}
.msg.streaming {
  border-left: 2px solid var(--accent);
}
.msg.streaming::after {
  content: '▋';
  animation: blink 1s infinite;
  color: var(--accent);
}
.msg.interrupted {
  opacity: 0.6;
  border-left: 2px solid var(--text2);
}
.msg.interrupted::after {
  content: ' [interrupted]';
  color: var(--text2);
  font-size: 0.75rem;
}
@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}
.msg .meta {
  font-size: 0.7rem;
  color: var(--text2);
  margin-top: 4px;
}

#controls {
  position: fixed;
  bottom: 0;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: linear-gradient(transparent, var(--bg) 30%);
}

.btn {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  transition: transform 0.15s, box-shadow 0.15s, background 0.3s;
}
.btn:hover { transform: scale(1.05); }
.btn:active { transform: scale(0.95); }

/* Audio level visualizer ring around mic button */
#micBtn {
  background: var(--accent);
  box-shadow: 0 0 0 0 rgba(233,69,96,0.4);
  position: relative;
}
#audioLevel {
  position: absolute;
  inset: -4px;
  border-radius: 50%;
  border: 2px solid transparent;
  pointer-events: none;
  transition: border-color 0.05s, box-shadow 0.05s;
}
#audioLevel.active {
  border-color: rgba(0,217,126,0.6);
}

/* Error toast */
.error-toast {
  position: fixed;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(233,69,96,0.15);
  border: 1px solid rgba(233,69,96,0.3);
  color: var(--accent);
  padding: 8px 20px;
  border-radius: 8px;
  font-size: 0.85rem;
  z-index: 200;
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
  max-width: 90%;
  text-align: center;
}
.error-toast.show { opacity: 1; }

/* Reconnect banner */
#reconnectBanner {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: rgba(233,69,96,0.9);
  color: white;
  text-align: center;
  padding: 8px;
  font-size: 0.85rem;
  z-index: 300;
  cursor: pointer;
}
#reconnectBanner.show { display: block; }

#micBtn.recording {
  animation: pulse 1.5s infinite;
  background: #ff2244;
}
#micBtn.vad-active {
  background: var(--green);
}
#micBtn.vad-active.recording {
  animation: pulse-green 1.5s infinite;
  background: #00ff99;
}
#micBtn.sleeping {
  background: var(--purple);
  animation: pulse-sleep 3s infinite;
}
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(233,69,96,0.6); }
  70% { box-shadow: 0 0 0 20px rgba(233,69,96,0); }
  100% { box-shadow: 0 0 0 0 rgba(233,69,96,0); }
}
@keyframes pulse-green {
  0% { box-shadow: 0 0 0 0 rgba(0,217,126,0.6); }
  70% { box-shadow: 0 0 0 20px rgba(0,217,126,0); }
  100% { box-shadow: 0 0 0 0 rgba(0,217,126,0); }
}
@keyframes pulse-sleep {
  0%, 100% { box-shadow: 0 0 0 0 rgba(157,78,221,0.4); opacity: 0.7; }
  50% { box-shadow: 0 0 0 15px rgba(157,78,221,0); opacity: 1; }
}

#clearBtn {
  width: 48px; height: 48px;
  background: var(--surface2);
  color: var(--text2);
  font-size: 16px;
}

#wakeToggle {
  width: 48px; height: 48px;
  background: var(--surface2);
  color: var(--text2);
  font-size: 14px;
}
#wakeToggle.active {
  background: var(--purple);
  color: var(--bg);
}

/* Speaker verification UI */
.header-row {
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
}
.header-btn {
  background: var(--surface2);
  color: var(--text2);
  border: none;
  padding: 6px 14px;
  border-radius: 8px;
  font-size: 0.75rem;
  cursor: pointer;
  transition: background 0.2s;
}
.header-btn:hover { background: var(--accent2); color: var(--text); }
.header-btn.active { background: var(--green); color: var(--bg); }

.verify-badge {
  display: inline-block;
  font-size: 0.65rem;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 6px;
  vertical-align: middle;
}
.verify-badge.pass { background: rgba(0,217,126,0.2); color: var(--green); }
.verify-badge.fail { background: rgba(233,69,96,0.2); color: var(--accent); }

/* Meeting companion */
.meeting-banner {
  display: none;
  background: rgba(233,69,96,0.15);
  color: var(--accent);
  text-align: center;
  padding: 6px 12px;
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.5px;
  width: 100%;
}
.meeting-banner.show { display: block; }
.meeting-entry {
  padding: 4px 0;
  font-size: 0.85rem;
  line-height: 1.4;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}
.meeting-entry .speaker {
  font-weight: 600;
  margin-right: 6px;
}
.meeting-entry .speaker.ham { color: var(--green); }
.meeting-entry .speaker.other { color: var(--accent2); }
.meeting-entry .speaker.kismet { color: var(--accent); }
.meeting-entry .timestamp {
  color: var(--text2);
  font-size: 0.7rem;
  margin-right: 6px;
}
#commandBtn {
  display: none;
  position: fixed;
  bottom: 100px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--accent);
  border: none;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  z-index: 50;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
#commandBtn:hover { background: var(--accent2); }
#commandBtn.recording { background: var(--green); animation: pulse 1s infinite; }

/* Enrollment modal */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 100;
  align-items: center;
  justify-content: center;
}
.modal-overlay.show { display: flex; }
.modal {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 28px;
  max-width: 420px;
  width: 90%;
  text-align: center;
}
.modal h2 { font-size: 1.2rem; margin-bottom: 16px; }
.modal p { color: var(--text2); font-size: 0.9rem; margin-bottom: 12px; line-height: 1.5; }
.modal .prompt-text {
  font-size: 1rem;
  color: var(--text);
  background: var(--surface2);
  padding: 12px;
  border-radius: 8px;
  margin: 12px 0;
  font-style: italic;
}
.modal .progress {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin: 16px 0;
}
.modal .progress .dot {
  width: 12px; height: 12px;
  border-radius: 50%;
  background: var(--surface2);
  transition: background 0.3s;
}
.modal .progress .dot.done { background: var(--green); }
.modal .progress .dot.active { background: var(--accent); animation: pulse 1s infinite; }
.modal-btn {
  background: var(--accent);
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-size: 0.9rem;
  cursor: pointer;
  margin: 4px;
}
.modal-btn.secondary {
  background: var(--surface2);
  color: var(--text2);
}
.modal-btn:disabled { opacity: 0.5; cursor: default; }

.msg.rejected {
  opacity: 0.4;
  border-left: 2px solid var(--accent);
}

@media (max-width: 480px) {
  .msg { max-width: 92%; }
}

/* =====================================================
   Phase 9 — Two-panel layout additions
   ===================================================== */

/* Streaming cursor blink */
@keyframes cursor-blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* Meeting mode left accent bar pulse */
@keyframes meeting-pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

/* Audio level ring for new panel layout */
.audio-ring {
  position: absolute;
  inset: -6px;
  border-radius: 50%;
  border: 2px solid transparent;
  pointer-events: none;
  transition: border-color 0.05s, box-shadow 0.05s;
}
.audio-ring.active {
  border-color: rgba(0, 217, 126, 0.6);
}

/* Mic button states — new class names for left panel */
.mic-btn {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--accent);
  box-shadow: 0 0 0 0 rgba(233, 69, 96, 0.4);
  position: relative;
  transition: transform 0.15s, box-shadow 0.15s, background 0.3s;
}
.mic-btn:hover { transform: scale(1.05); }
.mic-btn:active { transform: scale(0.95); }

.mic-btn.recording {
  animation: pulse 1.5s infinite;
  background: #ff2244;
}
.mic-btn.vad-active {
  background: var(--green);
}
.mic-btn.vad-active.recording {
  animation: pulse-green 1.5s infinite;
  background: #00ff99;
}
.mic-btn.sleeping {
  background: var(--purple);
  animation: pulse-sleep 3s infinite;
}

/* Secondary control buttons */
.ctrl-btn {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--surface2);
  color: var(--text2);
  transition: transform 0.15s, background 0.2s;
}
.ctrl-btn:hover { transform: scale(1.05); background: var(--accent2); color: var(--text); }
.ctrl-btn:active { transform: scale(0.95); }
.ctrl-btn.wake-active { background: var(--purple); color: white; }
.ctrl-btn.meeting-active { background: var(--accent); color: white; }

/* Message row style (new, replaces bubble style) */
.msg-row {
  display: flex;
  flex-direction: column;
  padding: 10px 16px;
  border-left: 3px solid transparent;
  line-height: 1.5;
  font-size: 0.95rem;
  transition: border-color 0.2s;
}
.msg-row.assistant { border-left-color: var(--accent); }
.msg-row.user { border-left-color: #0f3460; }
.msg-row.system { border-left-color: rgba(255,255,255,0.1); }
.msg-row .role-label {
  font-size: 0.7rem;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 3px;
}
.msg-row .msg-text { color: var(--text); }
.msg-row.streaming { border-left-color: var(--accent); }
.msg-row.streaming .msg-text::after {
  content: '▋';
  animation: cursor-blink 1s infinite;
  color: var(--accent);
}
.msg-row.interrupted { opacity: 0.5; font-style: italic; }
.msg-row.rejected { opacity: 0.4; border-left-color: var(--accent); }
.msg-row .msg-meta {
  font-size: 0.7rem;
  color: var(--text2);
  margin-top: 4px;
}

/* Meeting entry row */
.meeting-row {
  padding: 4px 16px;
  font-size: 0.85rem;
  line-height: 1.4;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  display: flex;
  gap: 6px;
  align-items: baseline;
}
.meeting-row .meeting-time { color: var(--text2); font-size: 0.7rem; }
.meeting-row .meeting-speaker { font-weight: 600; }
.meeting-row .meeting-speaker.ham { color: var(--green); }
.meeting-row .meeting-speaker.other { color: #0f3460; }
.meeting-row .meeting-speaker.kismet { color: var(--accent); }

/* Connection dot */
.conn-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
  transition: background 0.3s;
}
.conn-dot.connected { background: var(--green); }
.conn-dot.disconnected { background: var(--accent); }
.conn-dot.sleeping { background: var(--purple); }
.conn-dot.connecting { background: var(--text2); animation: pulse-sleep 2s infinite; }

/* Status text colors (reuse existing, now inline) */
.status-active { color: var(--green); }
.status-listening { color: var(--accent); }
.status-sleeping { color: var(--purple); }
.status-default { color: var(--text2); }

/* Mobile bottom dock */
@media (max-width: 767px) {
  .mobile-dock {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, var(--bg) 20%);
    padding: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    z-index: 40;
  }
}